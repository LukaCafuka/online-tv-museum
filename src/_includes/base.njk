<!DOCTYPE html>
<html lang="{{ lang or site.defaultLang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    
    <!-- Title and basic meta -->
    <title>{{ title }} | {{ site.t[lang or site.defaultLang].siteTitle }}</title>
    {% set pageDescription = description or (item.data.description[lang].short if item.data.description else '') or site.t[lang or site.defaultLang].siteDescription %}
    <meta name="description" content="{{ pageDescription }}" />
    {% if item.data %}
    <meta name="keywords" content="{{ item.data.brand }}, {{ item.data.model }}, {{ item.data.category }}, {{ item.data.year }}, vintage video equipment, professional broadcasting" />
    {% endif %}
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{{ site.url }}{{ page.url }}" />
    
    <!-- Language alternates -->
    {% if lang == 'en' and item.data %}
    <link rel="alternate" hreflang="hr" href="{{ site.url }}/oprema/{{ item.data.slug }}/" />
    <link rel="alternate" hreflang="en" href="{{ site.url }}/equipment/{{ item.data.slug }}/" />
    {% elif lang == 'hr' and item.data %}
    <link rel="alternate" hreflang="en" href="{{ site.url }}/equipment/{{ item.data.slug }}/" />
    <link rel="alternate" hreflang="hr" href="{{ site.url }}/oprema/{{ item.data.slug }}/" />
    {% elif lang == 'en' %}
    <link rel="alternate" hreflang="hr" href="{{ site.url }}/hr/" />
    {% elif lang == 'hr' %}
    <link rel="alternate" hreflang="en" href="{{ site.url }}/" />
    {% endif %}
    <link rel="alternate" hreflang="x-default" href="{{ site.url }}/" />
    
    <!-- Open Graph for social sharing -->
    <meta property="og:title" content="{{ title }} | {{ site.t[lang or site.defaultLang].siteTitle }}" />
    <meta property="og:description" content="{{ pageDescription }}" />
    {% set gallery = galleries[item.data.slug] if item.data %}
    {% if gallery and gallery.length %}
    <meta property="og:image" content="{{ site.url }}{{ gallery[0].src }}" />
    <meta name="twitter:image" content="{{ site.url }}{{ gallery[0].src }}" />
    {% endif %}
    <meta property="og:url" content="{{ site.url }}{{ page.url }}" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="{{ site.t[lang or site.defaultLang].siteTitle }}" />
    
    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{{ title }} | {{ site.t[lang or site.defaultLang].siteTitle }}" />
    <meta name="twitter:description" content="{{ pageDescription }}" />
    
    <!-- Structured Data for Equipment -->
    {% if item.data %}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Product",
      "name": "{{ item.data.brand }} {{ item.data.model }}",
      "brand": {
        "@type": "Brand",
        "name": "{{ item.data.brand }}"
      },
      "model": "{{ item.data.model }}",
      "releaseDate": "{{ item.data.year }}",
      "category": "{{ item.data.category }}",
      {% if gallery and gallery.length %}
      "image": [
        {% for img in gallery %}"{{ site.url }}{{ img.src }}"{{ "," if not loop.last }}{% endfor %}
      ],
      {% endif %}
      "description": "{{ item.templateContent | langSection(lang) | striptags | truncate(160) }}",
      "manufacturer": {
        "@type": "Organization",
        "name": "{{ item.data.brand }}"
      }
    }
    </script>
    {% endif %}
    
    <!-- Website structured data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "{{ site.t[lang or site.defaultLang].siteTitle }}",
      "description": "{{ site.t[lang or site.defaultLang].siteDescription }}",
      "url": "{{ site.url }}",
      "inLanguage": ["en", "hr"],
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "{{ site.url }}/?q={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    
    <link rel="stylesheet" href="/assets/vendor/jquery-ui.min.css" />
    <link rel="stylesheet" href="/assets/css/theme.css?v=1" />
</head>
<body class="site-body">
    {% set lang = lang or site.defaultLang %}
    <div class="page">
        {% include "header.njk" %}
        <main>
            {{ content | safe }}
        </main>
        <footer>&copy; {{ currentYear }} - z.com.hr</footer>
    </div>
    <div id="lightbox" class="lightbox hidden" role="dialog" aria-modal="true" aria-label="Image preview">
        <div class="lightbox-backdrop"></div>
        <div class="lightbox-content ui-widget ui-widget-content ui-corner-all">
            <button type="button" class="lightbox-close ui-state-default ui-corner-all" aria-label="Close">×</button>
            <div class="lightbox-nav" aria-hidden="true">
                <button type="button" class="lb-prev" aria-label="Previous image">‹</button>
                <button type="button" class="lb-next" aria-label="Next image">›</button>
            </div>
            <img id="lightbox-img" alt="Preview" />
            <div class="lightbox-actions">
                <a id="lightbox-open-original" href="#" target="_blank" rel="noopener" class="lightbox-original ui-state-default ui-corner-all">Full image ↗</a>
            </div>
            <p id="lightbox-caption"></p>
        </div>
    </div>
    <script src="/assets/vendor/jquery.min.js"></script>
    <script src="/assets/vendor/jquery-ui.min.js"></script>
    <script src="/assets/js/main.js"></script>
</body>
</html>
